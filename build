#!./wild
{
	"variables": {
	},
	"processors": {
		"dc": {
			"command": "dmd",
			"arguments": "-m64 -fPIC -debug -c -gc -Ikernel/src -defaultlib= -debuglib= -version=bare_metal -debug=allocations -of$out $in"
		},
		"ac": {
			"command": "cc/bin/x86_64-powernex-as",
			"arguments": "--64 -o $out $in"
		},
		"ld": {
			"command": "cc/bin/x86_64-powernex-ld",
			"arguments": "-o $out -z max-page-size=0x1000 $in -T kernel/src/os.ld"
		},
		"cp": {
			"command": "cp",
			"arguments": "-rf $in $out"
		},
		"iso": {
			"command": "grub-mkrescue",
			"arguments": "-d /usr/lib/grub/i386-pc -o $out $in"
		},
		"ndc": {
			"command": "dmd",
			"arguments": "-of$out -odutils/obj $in"
		},
		"generateSymbols" : {
			"command": "utils/generateSymbols",
			"arguments": "$in $out"
		},
		"makeInitrd" : {
			"command": "utils/makeInitrd",
			"arguments": "$in $out"
		}
	},
	"phonies": {

	},
	"missing": {
		"utils/generateSymbols": {
			"processor": "ndc",
			"input": "utils/generateSymbols.d"
		},
		"utils/makeInitrd": {
			"processor": "ndc",
			"input": "utils/makeInitrd.d"
		}
	},
	"rules": {
		"kernel/obj/*.o": {
			"processor": "dc",
			"input": "kernel/src/*.d"
		},
		"kernel/obj/asm/*.o": {
			"processor": "ac",
			"input": "kernel/src/*.S"
		},
		"powernex.krl": {
			"processor": "ld",
			"input": "kernel/obj/*.o"
		},
		"disk/boot/powernex.krl": {
			"processor": "cp",
			"input": "powernex.krl"
		},
		"disk/boot/powernex.map": {
			"processor": "generateSymbols",
			"input": "powernex.krl"
		},
		"disk/boot/powernex.dsk": {
			"processor": "makeInitrd",
			"input": "Initrd"
		},
		"powernex.iso": {
			"processor": "iso",
			"input": "disk"
		}
	},
	"targets": [
		"powernex.krl",
		"disk/boot/powernex.krl",
		"disk/boot/powernex.map",
		"disk/boot/powernex.dsk",
		"powernex.iso"
	]
}
